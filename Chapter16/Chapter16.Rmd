---
title: "Tidyverse Tutorial: R4DS Ch 16"
output: 
  learnr::tutorial:
    css: css/style.css
    theme: cerulean
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
tutorial_options(exercise.checker = gradethis::grade_learnr)
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(nycflights13)
```

## Tidyverse Tutorial: R4DS Ch 16

### 16.1.1 Easy OT

```{r Easy-OT1}
quiz(
  question("What are the packages you need for Chapter 16? (There are multiple answers)",
    answer("tidyverse", correct = TRUE),
    answer("learnr"),
    answer("nycflights13", correct = TRUE),
    answer("lubridate", correct = TRUE)
  )
)
```

### 16.2.1 Easy OT

```{r Easy-OT2}
quiz(
  question("How can we output yesterday's date?",
    answer("today-1()"),
    answer("today()-1", correct = TRUE),
    answer("yesterday()")
  )
)
```


### Intermediate 16.2.2 OT

Make a new column that says the abbreviation of the month instead of the number (e,g: Jan instead of 1):

```{r Intermediate-OT1, exercise=TRUE}
flights %>%
  select(month) %>%
  mutate(month_name = )
```
```{r Intermediate-OT1-Hint}
# month(month, label=TRUE)
```
```{r Intermediate-OT1-Solution}
flights %>%
  select(month) %>%
  mutate(month_name = month(month, label=TRUE))
```
```{r Intermediate-OT1-check}
gradethis::grade_this_code()
```

### Intermediate 16.2.3 OT

Make three new columns to the flights data set which contains the date_time of departure and arrival time, and the differences between them. (Use difftime())

```{r Intermediate-OT2, exercise=TRUE}
flights %>%
  mutate(departure_time = make_datetime(),
         arrival_time = make_datetime(),
         diff_time = )
```
```{r Intermediate-OT2-Hint}
flights %>%
  mutate(departure_time = make_datetime(year, 
                                        month, 
                                        day, 
                                        dep_time %/% 100, 
                                        dep_time %% 100),
         arrival_time = make_datetime(year, 
                                      month, 
                                      day, 
                                      arr_time %/% 100, 
                                      arr_time %% 100),
         diff_time = difftime(arrival_time, departure_time))
```
```{r Intermediate-OT2-Solution}
flights %>%
  mutate(departure_time = make_datetime(year, 
                                        month, 
                                        day, 
                                        dep_time %/% 100, 
                                        dep_time %% 100),
         arrival_time = make_datetime(year, 
                                      month, 
                                      day, 
                                      arr_time %/% 100, 
                                      arr_time %% 100),
         diff_time = difftime(arrival_time, departure_time))
```
```{r Intermediate-OT2-check}
gradethis::grade_this_code()
```

### Challenging 16.2.4 OT

Plot a grouped bar chart of top 5 origin_dest by the number of flights of each year_month in a grouped bar chart as such:


```{r Challenging-OT, exercise=TRUE}
flights_grouped <- flights %>%
  mutate(month = month(),
         year_month = paste(year, "-", month),
         origin_dest = paste(origin, "-", dest)) %>%
  group_by() %>%
  summarise(count = n()) 

flights_grouped %>%
  arrange(desc()) %>%
  group_by() %>% 
  slice(1:5) %>%
  ggplot(aes()) + 
  geom_bar(position="dodge", stat="identity")
```
```{r Challenging-OT-Hint}
# Change the month number into abbreviation of the month (e,g: 1 to Jan).
flights_grouped <- flights %>%
  mutate(month = month(month, label=TRUE),
         # Concatenate the year and month with '-' as the separator.
         year_month = paste(year, "-", month),
         # Concatenate the origin and destination with '-' as the separator.
         origin_dest = paste(origin, "-", dest)) %>%
  # Group the data by the concatenated columns.
  group_by(year_month, origin_dest) %>%
  # Summarise the grouped data by the number of the flights.
  summarise(count = n()) 

# Plot the top 5 origin_dest by the number of flights of each year_month in a grouped bar chart.
flights_grouped %>%
  arrange(desc(count)) %>%
  group_by(year_month) %>% 
  slice(1:5) %>%
  ggplot(aes(x = year_month, y = count, fill = origin_dest)) + 
  geom_bar(position="dodge", stat="identity")
```
```{r Challenging-OT-Solution}
flights_grouped <- flights %>%
  mutate(month = month(month, label=TRUE),
         year_month = paste(year, "-", month),
         origin_dest = paste(origin, "-", dest)) %>%
  group_by(year_month, origin_dest) %>%
  summarise(count = n()) 

flights_grouped %>%
  arrange(desc(count)) %>%
  group_by(year_month) %>% 
  slice(1:5) %>%
  ggplot(aes(x = year_month, y = count, fill=origin_dest)) + 
  geom_bar(position="dodge", stat="identity")
```
```{r Challenging-OT-check}
gradethis::grade_this_code()
```
